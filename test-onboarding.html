<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Onboarding - Rupiya</title>
  
  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/onboarding.css">
  <link rel="stylesheet" href="assets/css/product-tour.css">
  <link rel="stylesheet" href="assets/css/quick-start-checklist.css">
  
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 40px;
      max-width: 1200px;
      margin: 0 auto;
      background: #f8fafc;
    }
    
    .test-container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    h1 {
      color: #1e293b;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #64748b;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .test-section:last-child {
      border-bottom: none;
    }
    
    h2 {
      color: #334155;
      font-size: 18px;
      margin-bottom: 15px;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: #667eea;
      color: white;
    }
    
    .btn-primary:hover {
      background: #5568d3;
    }
    
    .btn-secondary {
      background: #64748b;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #475569;
    }
    
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    .btn-success {
      background: #22c55e;
      color: white;
    }
    
    .btn-success:hover {
      background: #16a34a;
    }
    
    .info-box {
      background: #f1f5f9;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .info-box code {
      background: #e2e8f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .status-success {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-warning {
      background: #fef3c7;
      color: #92400e;
    }
    
    .console-output {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .console-output .success {
      color: #22c55e;
    }
    
    .console-output .info {
      color: #60a5fa;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ§ª Onboarding Testing Dashboard</h1>
    <p class="subtitle">Test and debug the onboarding flow, product tours, and quick start checklist</p>
    
    <!-- Main Onboarding -->
    <div class="test-section">
      <h2>ğŸ“‹ Main Onboarding Flow (5 Steps)</h2>
      <p>Test the main onboarding modal that guides new users through the app.</p>
      
      <div class="btn-group">
        <button class="btn btn-primary" onclick="startOnboarding()">
          â–¶ï¸ Start Onboarding
        </button>
        <button class="btn btn-secondary" onclick="checkOnboardingStatus()">
          ğŸ“Š Check Status
        </button>
        <button class="btn btn-danger" onclick="resetOnboarding()">
          ğŸ”„ Reset Onboarding
        </button>
      </div>
      
      <div class="info-box">
        <strong>Console Command:</strong><br>
        <code>onboardingService.startOnboarding()</code>
      </div>
    </div>
    
    <!-- Product Tours -->
    <div class="test-section">
      <h2>ğŸ¯ Page-Specific Product Tours</h2>
      <p>Test interactive tours for different pages.</p>
      
      <div class="btn-group">
        <button class="btn btn-primary" onclick="startTour('dashboard')">
          ğŸ“Š Dashboard Tour
        </button>
        <button class="btn btn-primary" onclick="startTour('expenses')">
          ğŸ’¸ Expenses Tour
        </button>
        <button class="btn btn-primary" onclick="startTour('budgets')">
          ğŸ’° Budgets Tour
        </button>
        <button class="btn btn-primary" onclick="startTour('goals')">
          ğŸ¯ Goals Tour
        </button>
        <button class="btn btn-danger" onclick="resetAllTours()">
          ğŸ”„ Reset All Tours
        </button>
      </div>
      
      <div class="info-box">
        <strong>Console Command:</strong><br>
        <code>productTour.startTour('dashboard')</code>
      </div>
    </div>
    
    <!-- Quick Start Checklist -->
    <div class="test-section">
      <h2>âœ… Quick Start Checklist</h2>
      <p>Test the floating checklist widget for new users.</p>
      
      <div class="btn-group">
        <button class="btn btn-success" onclick="showChecklist()">
          ğŸ‘ï¸ Show Checklist
        </button>
        <button class="btn btn-secondary" onclick="checkChecklistStatus()">
          ğŸ“Š Check Status
        </button>
        <button class="btn btn-danger" onclick="resetChecklist()">
          ğŸ”„ Reset Checklist
        </button>
      </div>
      
      <div class="info-box">
        <strong>Console Command:</strong><br>
        <code>quickStartChecklist.forceShow()</code>
      </div>
    </div>
    
    <!-- Sample Data -->
    <div class="test-section">
      <h2>ğŸ“Š Sample Data</h2>
      <p>Generate or clear sample financial data for testing.</p>
      
      <div class="btn-group">
        <button class="btn btn-success" onclick="generateSampleData()">
          â• Generate Sample Data
        </button>
        <button class="btn btn-danger" onclick="clearSampleData()">
          ğŸ—‘ï¸ Clear Sample Data
        </button>
        <button class="btn btn-secondary" onclick="checkSampleDataStatus()">
          ğŸ“Š Check Status
        </button>
      </div>
      
      <div class="info-box">
        <strong>Console Command:</strong><br>
        <code>sampleDataService.generateSampleData(firebase.auth().currentUser.uid)</code>
      </div>
    </div>
    
    <!-- Complete Reset -->
    <div class="test-section">
      <h2>ğŸ”„ Complete Reset</h2>
      <p>Reset everything to test the full new user experience.</p>
      
      <div class="btn-group">
        <button class="btn btn-danger" onclick="resetEverything()">
          ğŸ”¥ Reset Everything
        </button>
        <button class="btn btn-primary" onclick="reloadPage()">
          ğŸ”„ Reload Page
        </button>
      </div>
      
      <div class="info-box">
        <strong>Console Command:</strong><br>
        <code>onboardingService.resetAll(); location.reload();</code>
      </div>
    </div>
    
    <!-- Console Output -->
    <div class="test-section">
      <h2>ğŸ’» Console Output</h2>
      <div id="consoleOutput" class="console-output">
        <div class="info">Ready to test onboarding features...</div>
      </div>
    </div>
  </div>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <!-- Firebase Config -->
  <script src="assets/js/config/firebase-config.js"></script>
  
  <!-- Services -->
  <script type="module" src="assets/js/services/onboarding-service.js"></script>
  <script type="module" src="assets/js/services/sample-data-service.js"></script>
  <script type="module" src="assets/js/components/quick-start-checklist.js"></script>
  <script type="module" src="assets/js/components/product-tour.js"></script>
  <script type="module" src="assets/js/utils/onboarding-init.js"></script>
  <script type="module" src="assets/js/utils/help-tour-init.js"></script>
  
  <script>
    // Helper function to log to console output
    function log(message, type = 'info') {
      const output = document.getElementById('consoleOutput');
      const line = document.createElement('div');
      line.className = type;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }
    
    // Main Onboarding
    function startOnboarding() {
      if (window.onboardingService) {
        window.onboardingService.startOnboarding();
        log('âœ… Onboarding started', 'success');
      } else {
        log('âŒ onboardingService not available yet. Wait a moment and try again.', 'error');
      }
    }
    
    function checkOnboardingStatus() {
      if (window.onboardingService) {
        const isComplete = window.onboardingService.isOnboardingComplete;
        const currentStep = window.onboardingService.currentStep;
        const completedSteps = Array.from(window.onboardingService.completedSteps);
        log(`ğŸ“Š Onboarding Status:`, 'info');
        log(`   Complete: ${isComplete}`, 'info');
        log(`   Current Step: ${currentStep}`, 'info');
        log(`   Completed Steps: ${completedSteps.join(', ') || 'none'}`, 'info');
      } else {
        log('âŒ onboardingService not available', 'error');
      }
    }
    
    function resetOnboarding() {
      if (window.onboardingService) {
        window.onboardingService.resetOnboarding();
        log('âœ… Onboarding reset complete', 'success');
      } else {
        log('âŒ onboardingService not available', 'error');
      }
    }
    
    // Product Tours
    function startTour(page) {
      if (window.productTour) {
        window.productTour.startTour(page);
        log(`âœ… ${page} tour started`, 'success');
      } else {
        log('âŒ productTour not available yet. Wait a moment and try again.', 'error');
      }
    }
    
    function resetAllTours() {
      if (window.productTour) {
        window.productTour.reset();
        log('âœ… All tours reset', 'success');
      } else {
        log('âŒ productTour not available', 'error');
      }
    }
    
    // Quick Start Checklist
    function showChecklist() {
      if (window.quickStartChecklist) {
        window.quickStartChecklist.forceShow();
        log('âœ… Checklist shown', 'success');
      } else {
        log('âŒ quickStartChecklist not available', 'error');
      }
    }
    
    function checkChecklistStatus() {
      if (window.quickStartChecklist) {
        const completed = window.quickStartChecklist.completedTasks.size;
        const total = window.quickStartChecklist.tasks.length;
        const progress = window.quickStartChecklist.getProgress();
        log(`ğŸ“Š Checklist Status:`, 'info');
        log(`   Progress: ${progress}% (${completed}/${total} tasks)`, 'info');
        log(`   Dismissed: ${window.quickStartChecklist.isDismissed}`, 'info');
      } else {
        log('âŒ quickStartChecklist not available', 'error');
      }
    }
    
    function resetChecklist() {
      if (window.quickStartChecklist) {
        window.quickStartChecklist.reset();
        log('âœ… Checklist reset', 'success');
      } else {
        log('âŒ quickStartChecklist not available', 'error');
      }
    }
    
    // Sample Data
    async function generateSampleData() {
      if (!firebase.auth().currentUser) {
        log('âŒ Please login first', 'error');
        return;
      }
      
      if (window.sampleDataService) {
        try {
          log('â³ Generating sample data...', 'info');
          await window.sampleDataService.generateSampleData(firebase.auth().currentUser.uid);
          log('âœ… Sample data generated! Reload page to see it.', 'success');
        } catch (error) {
          log(`âŒ Error: ${error.message}`, 'error');
        }
      } else {
        log('âŒ sampleDataService not available yet. Wait a moment and try again.', 'error');
      }
    }
    
    async function clearSampleData() {
      if (!firebase.auth().currentUser) {
        log('âŒ Please login first', 'error');
        return;
      }
      
      if (window.sampleDataService) {
        try {
          log('â³ Clearing sample data...', 'info');
          await window.sampleDataService.clearSampleData(firebase.auth().currentUser.uid);
          log('âœ… Sample data cleared! Reload page.', 'success');
        } catch (error) {
          log(`âŒ Error: ${error.message}`, 'error');
        }
      } else {
        log('âŒ sampleDataService not available', 'error');
      }
    }
    
    function checkSampleDataStatus() {
      if (window.sampleDataService) {
        const isActive = window.sampleDataService.isActive();
        log(`ğŸ“Š Sample Data Active: ${isActive}`, 'info');
      } else {
        log('âŒ sampleDataService not available', 'error');
      }
    }
    
    // Complete Reset
    function resetEverything() {
      if (window.onboardingService) {
        window.onboardingService.resetAll();
        log('âœ… Everything reset! Click "Reload Page" to see changes.', 'success');
      } else {
        log('âŒ onboardingService not available', 'error');
      }
    }
    
    function reloadPage() {
      location.reload();
    }
    
    // Wait for services to load
    setTimeout(() => {
      if (window.onboardingService && window.productTour && window.quickStartChecklist) {
        log('âœ… All services loaded and ready!', 'success');
      } else {
        log('âš ï¸ Some services may not be loaded yet. Try again in a moment.', 'warning');
      }
    }, 2000);
  </script>
</body>
</html>
