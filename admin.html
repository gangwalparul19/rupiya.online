<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Rupiya Admin - Platform Analytics and Insights">
  <meta name="theme-color" content="#4A90E2">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin Dashboard - Rupiya</title>
  
  <!-- Favicon -->
  <link rel="icon" href="assets/images/logo.png" type="image/png">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="assets/css/bundles/core.bundle.css">
  <link rel="stylesheet" href="assets/css/bundles/dashboard.bundle.css">
  <!-- Page-specific styles -->
  <link rel="stylesheet" href="assets/css/admin.css">
<!-- Page-specific styles -->
  <link rel="stylesheet" href="assets/css/admin.css">
  
<!-- Page-specific styles -->
  <link rel="stylesheet" href="assets/css/dashboard-common.css">
  <link rel="stylesheet" href="assets/css/admin.css">
<!-- Auth Guard -->
  <script src="assets/js/utils/auth-guard.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body class="admin-body">
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-header-left">
      <a href="dashboard.html" class="admin-logo">
        <img src="assets/images/logo.png" alt="Rupiya">
        <span class="logo-text">Rupiya</span>
      </a>
      <span class="admin-badge">Admin</span>
    </div>
    <div class="admin-header-right">
      <div class="admin-user-info">
        <span class="admin-user-avatar" id="adminUserAvatar">A</span>
        <span class="admin-user-email" id="adminUserEmail">Loading...</span>
      </div>
      <a href="dashboard.html" class="btn btn-sm btn-outline">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Back to App
      </a>
      <button class="btn btn-sm btn-danger-outline" id="logoutBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
        </svg>
        Logout
      </button>
    </div>
  </header>

  <!-- Access Denied State -->
  <div class="admin-access-denied" id="accessDenied" style="display: none;">
    <div class="access-denied-card">
      <div class="access-denied-icon">ğŸ”’</div>
      <h2 class="access-denied-title">Access Denied</h2>
      <p class="access-denied-message">You don't have permission to access the admin dashboard.</p>
      <a href="dashboard.html" class="btn btn-primary">Go to Dashboard</a>
    </div>
  </div>

  <!-- Loading State -->
  <div class="admin-loading" id="loadingState">
    <div class="spinner-lg"></div>
    <p>Loading admin dashboard...</p>
  </div>

  <!-- Admin Content -->
  <main class="admin-main" id="adminContent" style="display: none;">
    <!-- Page Header -->
    <div class="admin-page-header">
      <div class="page-header-content">
        <h1 class="admin-title">ğŸ“Š Platform Analytics</h1>
        <p class="admin-subtitle">User analytics and platform usage insights</p>
      </div>
      <div class="page-header-actions">
        <span class="last-updated" id="lastUpdated">Last updated: --</span>
        <button class="refresh-btn" id="refreshBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
          Refresh
        </button>
      </div>
    </div>

    <!-- Platform Stats - User Collection KPIs -->
    <section class="admin-section">
      <div class="admin-stats-grid">
        <!-- Total Users -->
        <div class="admin-stat-card highlight">
          <div class="stat-icon-wrapper">
            <span class="stat-icon">ğŸ‘¥</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="totalUsers">-</div>
            <div class="stat-label">Total Users</div>
            <div class="stat-trend positive" id="usersTrend">--</div>
          </div>
        </div>

        <!-- Users from India -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper blue">
            <span class="stat-icon">ğŸ‡®ğŸ‡³</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="usersFromIndia">-</div>
            <div class="stat-label">From India</div>
            <div class="stat-percentage" id="indiaPercentage">--%</div>
          </div>
        </div>

        <!-- Users from Outside India -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper green">
            <span class="stat-icon">ğŸŒ</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="usersOutsideIndia">-</div>
            <div class="stat-label">Outside India</div>
            <div class="stat-percentage" id="outsideIndiaPercentage">--%</div>
          </div>
        </div>

        <!-- Active Users (Last 30 Days) -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper orange">
            <span class="stat-icon">ğŸŸ¢</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="activeUsersMonth">-</div>
            <div class="stat-label">Active (30d)</div>
            <div class="stat-percentage" id="activePercentage">--%</div>
          </div>
        </div>

        <!-- Inactive Users (30+ Days) -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper red">
            <span class="stat-icon">ğŸ˜´</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="inactiveUsersCount">-</div>
            <div class="stat-label">Inactive (30d+)</div>
            <div class="stat-percentage" id="inactivePercentage">--%</div>
          </div>
        </div>

        <!-- Users with Location Data -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper purple">
            <span class="stat-icon">ğŸ“</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="usersWithLocation">-</div>
            <div class="stat-label">With Location</div>
            <div class="stat-percentage" id="locationPercentage">--%</div>
          </div>
        </div>

        <!-- Users with Display Name -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper teal">
            <span class="stat-icon">ğŸ“</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="usersWithName">-</div>
            <div class="stat-label">With Display Name</div>
            <div class="stat-percentage" id="namePercentage">--%</div>
          </div>
        </div>

        <!-- Users with Phone -->
        <div class="admin-stat-card">
          <div class="stat-icon-wrapper pink">
            <span class="stat-icon">ğŸ“±</span>
          </div>
          <div class="stat-content">
            <div class="stat-value" id="usersWithPhone">-</div>
            <div class="stat-label">With Phone</div>
            <div class="stat-percentage" id="phonePercentage">--%</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Encryption Notice -->
    <section class="admin-section">
      <div class="encryption-notice">
        <div class="encryption-notice-icon">ğŸ”</div>
        <div class="encryption-notice-content">
          <h3>Data Privacy & Security</h3>
          <p>Financial data (amounts, transactions, investments) is end-to-end encrypted and cannot be accessed by administrators. This dashboard shows only user analytics and platform usage statistics.</p>
        </div>
      </div>
    </section>

    <!-- User Activity -->
    <section class="admin-section">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ‘¤ User Activity</h2>
        <span class="section-badge">Real-time</span>
      </div>
      <div class="activity-grid">
        <div class="activity-card active-today">
          <div class="activity-ring">
            <div class="activity-icon">ğŸŸ¢</div>
          </div>
          <div class="activity-value" id="activeToday">-</div>
          <div class="activity-label">Active Today</div>
        </div>
        <div class="activity-card active-week">
          <div class="activity-ring">
            <div class="activity-icon">ğŸ“…</div>
          </div>
          <div class="activity-value" id="activeThisWeek">-</div>
          <div class="activity-label">This Week</div>
        </div>
        <div class="activity-card active-month">
          <div class="activity-ring">
            <div class="activity-icon">ğŸ“†</div>
          </div>
          <div class="activity-value" id="activeThisMonth">-</div>
          <div class="activity-label">This Month</div>
        </div>
        <div class="activity-card inactive">
          <div class="activity-ring">
            <div class="activity-icon">ğŸ˜´</div>
          </div>
          <div class="activity-value" id="inactiveUsers">-</div>
          <div class="activity-label">Inactive (30d+)</div>
        </div>
      </div>
    </section>

    <!-- Monitoring Tabs -->
    <section class="admin-section">
      <div class="monitoring-tabs">
        <button class="monitoring-tab-btn active" onclick="switchMonitoringTab('registration')">ğŸ“ˆ Registration</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('performance')">âš¡ Performance</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('analytics')">ğŸ“Š Analytics</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('notifications')">ğŸ”” Notifications</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('sync')">ğŸ“¡ Sync</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('encryption')">ğŸ” Encryption</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('validation')">âœ“ Validation</button>
        <button class="monitoring-tab-btn" onclick="switchMonitoringTab('backup')">ğŸ’¾ Backup</button>
      </div>
    </section>

    <!-- Performance Monitoring Tab -->
    <section class="admin-section monitoring-tab-content" id="performance-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">âš¡ Performance Monitoring</h2>
        <button class="btn btn-sm" onclick="refreshPerformanceMetrics()">Refresh</button>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Performance Metrics</h3>
          <div id="performanceMetrics" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Performance Alerts</h3>
          <div id="performanceAlerts" class="alerts-list"></div>
        </div>
      </div>
      <div class="monitoring-card full-width">
        <h3>Performance Report</h3>
        <div id="performanceReport" class="report-content"></div>
      </div>
    </section>

    <!-- Analytics Tab -->
    <section class="admin-section monitoring-tab-content" id="analytics-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ“Š User Analytics</h2>
        <button class="btn btn-sm" onclick="generateTestAnalytics()">Generate Test Data</button>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Session Analytics</h3>
          <div id="sessionAnalytics" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Feature Usage</h3>
          <div id="featureUsageStats" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Error Statistics</h3>
          <div id="errorStats" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Conversion Funnel</h3>
          <div id="conversionFunnel" class="metrics-list"></div>
        </div>
      </div>
    </section>

    <!-- Notifications Tab -->
    <section class="admin-section monitoring-tab-content" id="notifications-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ”” Push Notifications</h2>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Notification Status</h3>
          <div id="notificationStatus" class="metrics-list"></div>
          <div class="button-group">
            <button class="btn btn-sm" onclick="requestNotificationPermission()">Request Permission</button>
            <button class="btn btn-sm" onclick="subscribeNotifications()">Subscribe</button>
          </div>
        </div>
        <div class="monitoring-card">
          <h3>Send Test Notifications</h3>
          <div class="button-group">
            <button class="btn btn-sm" onclick="testBudgetNotification()">Budget Alert</button>
            <button class="btn btn-sm" onclick="testGoalNotification()">Goal Milestone</button>
            <button class="btn btn-sm" onclick="testEMINotification()">EMI Due</button>
          </div>
        </div>
      </div>
      <div class="monitoring-card full-width">
        <h3>Notification History</h3>
        <div id="notificationHistory" class="log-container"></div>
      </div>
    </section>

    <!-- Offline Sync Tab -->
    <section class="admin-section monitoring-tab-content" id="sync-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ“¡ Offline Data Sync</h2>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Sync Status</h3>
          <div id="syncStatus" class="metrics-list"></div>
          <button class="btn btn-sm" onclick="refreshSyncStatus()">Refresh</button>
        </div>
        <div class="monitoring-card">
          <h3>Sync Queue</h3>
          <div id="syncQueue" class="metrics-list"></div>
        </div>
      </div>
      <div class="monitoring-card full-width">
        <h3>Sync Operations</h3>
        <div class="button-group">
          <button class="btn btn-sm" onclick="queueTestOperation()">Queue Test</button>
          <button class="btn btn-sm" onclick="syncAll()">Sync All</button>
          <button class="btn btn-sm" onclick="retryFailed()">Retry Failed</button>
          <button class="btn btn-sm btn-danger-outline" onclick="clearQueue()">Clear Queue</button>
        </div>
        <div id="syncLog" class="log-container"></div>
      </div>
    </section>

    <!-- Encryption Tab -->
    <section class="admin-section monitoring-tab-content" id="encryption-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ” Encryption at Rest</h2>
      </div>
      <div class="monitoring-card">
        <h3>Encryption Setup</h3>
        <input type="password" id="masterPassword" placeholder="Enter master password" class="form-input">
        <button class="btn btn-sm" onclick="initializeEncryption()">Initialize Encryption</button>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Encryption Status</h3>
          <div id="encryptionStatus" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Encryption Statistics</h3>
          <div id="encryptionStats" class="metrics-list"></div>
        </div>
      </div>
      <div class="monitoring-card full-width">
        <h3>Test Encryption</h3>
        <div class="button-group">
          <button class="btn btn-sm" onclick="testEncryption()">Test Encrypt/Decrypt</button>
          <button class="btn btn-sm" onclick="testFieldEncryption()">Test Field Encryption</button>
        </div>
        <div id="encryptionLog" class="log-container"></div>
      </div>
    </section>

    <!-- Validation Tab -->
    <section class="admin-section monitoring-tab-content" id="validation-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">âœ“ Data Validation</h2>
      </div>
      <div class="monitoring-card full-width">
        <h3>Test Data Validation</h3>
        <div class="button-group">
          <button class="btn btn-sm" onclick="testExpenseValidation()">Test Expense Validation</button>
          <button class="btn btn-sm" onclick="testInvalidData()">Test Invalid Data</button>
          <button class="btn btn-sm" onclick="testSanitization()">Test XSS Sanitization</button>
        </div>
        <div id="validationLog" class="log-container"></div>
      </div>
    </section>

    <!-- Backup Tab -->
    <section class="admin-section monitoring-tab-content" id="backup-tab" style="display: none;">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ’¾ Backup & Export</h2>
      </div>
      <div class="monitoring-grid">
        <div class="monitoring-card">
          <h3>Backup Operations</h3>
          <div class="button-group">
            <button class="btn btn-sm" onclick="exportAllData()">Export All Data</button>
            <button class="btn btn-sm" onclick="estimateBackupSize()">Estimate Size</button>
          </div>
          <div id="backupStatus" class="metrics-list"></div>
        </div>
        <div class="monitoring-card">
          <h3>Backup History</h3>
          <div id="backupHistory" class="metrics-list"></div>
        </div>
      </div>
    </section>

    <!-- Location Stats -->
    <section class="admin-section">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸŒ Users by Location</h2>
        <p class="text-muted location-info" id="unknownLocationCount" style="display:none;"></p>
      </div>
      <div class="location-grid">
        <div class="location-card">
          <div class="location-card-header">
            <span class="location-card-icon">ğŸŒ</span>
            <h3 class="location-card-title">By Country</h3>
          </div>
          <div class="location-list" id="countryList">
            <div class="location-loading">Loading...</div>
          </div>
        </div>
        <div class="location-card">
          <div class="location-card-header">
            <span class="location-card-icon">ğŸ™ï¸</span>
            <h3 class="location-card-title">By City</h3>
          </div>
          <div class="location-list" id="cityList">
            <div class="location-loading">Loading...</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Users Table -->
    <section class="admin-section">
      <div class="section-header-enhanced">
        <h2 class="section-title">ğŸ‘¥ User Directory</h2>
        <div class="section-actions">
          <div class="search-box">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <input type="text" id="userSearch" placeholder="Search users..." class="search-input">
          </div>
          <div class="pagination-info" id="paginationInfo">Showing 0 users</div>
        </div>
      </div>
      
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th class="th-user">User</th>
              <th class="th-location">Location</th>
              <th class="th-joined">Joined</th>
              <th class="th-active">Last Active</th>
              <th class="th-status">Status</th>
            </tr>
          </thead>
          <tbody id="usersTableBody">
            <tr><td colspan="5" class="text-center loading-row">
              <div class="table-loading">
                <div class="spinner-sm"></div>
                <span>Loading users...</span>
              </div>
            </td></tr>
          </tbody>
        </table>
      </div>
      
      <div class="pagination-wrapper">
        <div class="pagination-controls">
          <button class="pagination-btn" id="firstPageBtn" disabled title="First Page">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
            </svg>
          </button>
          <button class="pagination-btn" id="prevPageBtn" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Previous
          </button>
          <div class="pagination-pages" id="paginationPages">
            <span class="page-number active">1</span>
          </div>
          <button class="pagination-btn" id="nextPageBtn">
            Next
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
          <button class="pagination-btn" id="lastPageBtn" title="Last Page">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
        <div class="pagination-size">
          <label>Show:</label>
          <select id="pageSizeSelect">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span>per page</span>
        </div>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  
  <script type="module" src="assets/js/pages/admin.js"></script>
  <script type="module" src="assets/js/utils/dashboard-common.js"></script>
</body>
</html>
