<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Rupiya Admin - Platform Analytics and Insights">
  <meta name="theme-color" content="#4A90E2">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin Dashboard - Rupiya</title>
  
  <!-- Favicon -->
  <link rel="icon" href="assets/images/logo.png" type="image/png">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/dark-mode.css">
  <link rel="stylesheet" href="assets/css/admin.css">
  <link rel="stylesheet" href="assets/css/sidebar.css">
  
  <!-- Auth Guard -->
  <script src="assets/js/utils/auth-guard.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body class="admin-body">
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-header-left">
      <a href="dashboard.html" class="admin-logo">
        <img src="assets/images/logo.png" alt="Rupiya">
      </a>
      <span class="admin-badge">Admin</span>
    </div>
    <div class="admin-header-right">
      <span class="admin-user" id="adminUserEmail">Loading...</span>
      <a href="dashboard.html" class="btn btn-sm btn-outline">â† Back to App</a>
      <button class="btn btn-sm btn-outline" id="logoutBtn">Logout</button>
    </div>
  </header>

  <!-- Access Denied State -->
  <div class="admin-access-denied" id="accessDenied" style="display: none;">
    <div class="access-denied-icon">ğŸ”’</div>
    <h2 class="access-denied-title">Access Denied</h2>
    <p class="access-denied-message">You don't have permission to access the admin dashboard.</p>
    <a href="dashboard.html" class="btn btn-primary">Go to Dashboard</a>
  </div>

  <!-- Loading State -->
  <div class="admin-loading" id="loadingState">
    <div class="spinner-lg"></div>
    <p>Loading admin dashboard...</p>
  </div>

  <!-- Admin Content -->
  <main class="admin-main" id="adminContent" style="display: none;">
    <!-- Page Header -->
    <div class="admin-page-header">
      <div>
        <h1 class="admin-title">Platform Analytics</h1>
        <p class="admin-subtitle">User analytics and platform usage insights (financial data is encrypted)</p>
      </div>
      <button class="refresh-btn" id="refreshBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
        </svg>
        Refresh
      </button>
    </div>

    <!-- Platform Stats -->
    <section class="admin-section">
      <div class="admin-stats-grid">
        <div class="admin-stat-card highlight">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-content">
            <div class="stat-value" id="totalUsers">-</div>
            <div class="stat-label">Total Users</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <div class="stat-value" id="totalTransactions">-</div>
            <div class="stat-label">Total Records</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
          <div class="stat-content">
            <div class="stat-value" id="totalFamilyGroups">-</div>
            <div class="stat-label">Family Groups</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">âœˆï¸</div>
          <div class="stat-content">
            <div class="stat-value" id="totalTripGroups">-</div>
            <div class="stat-label">Trip Groups</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Encryption Notice -->
    <section class="admin-section">
      <div class="encryption-notice">
        <div class="encryption-notice-icon">ğŸ”</div>
        <div class="encryption-notice-content">
          <h3>Data Privacy & Security</h3>
          <p>Financial data (amounts, transactions, investments) is end-to-end encrypted and cannot be accessed by administrators. This dashboard shows only user analytics and platform usage statistics to respect user privacy.</p>
        </div>
      </div>
    </section>

    <!-- User Activity -->
    <section class="admin-section">
      <h2 class="section-title">ğŸ‘¤ User Activity</h2>
      <div class="activity-grid">
        <div class="activity-card">
          <div class="activity-icon">ğŸŸ¢</div>
          <div class="activity-value" id="activeToday">-</div>
          <div class="activity-label">Active Today</div>
        </div>
        <div class="activity-card">
          <div class="activity-icon">ğŸ“…</div>
          <div class="activity-value" id="activeThisWeek">-</div>
          <div class="activity-label">This Week</div>
        </div>
        <div class="activity-card">
          <div class="activity-icon">ğŸ“†</div>
          <div class="activity-value" id="activeThisMonth">-</div>
          <div class="activity-label">This Month</div>
        </div>
        <div class="activity-card">
          <div class="activity-icon">ğŸ˜´</div>
          <div class="activity-value" id="inactiveUsers">-</div>
          <div class="activity-label">Inactive</div>
        </div>
      </div>
    </section>

    <!-- Location Stats -->
    <section class="admin-section">
      <h2 class="section-title">ğŸŒ Users by Location</h2>
      <p class="text-muted location-info" id="unknownLocationCount" style="display:none; margin-bottom: 1rem; font-size: 0.875rem;"></p>
      <div class="location-grid">
        <div class="location-card">
          <h3 class="location-card-title">By Country</h3>
          <div class="location-list" id="countryList">
            <p class="text-muted">Loading...</p>
          </div>
        </div>
        <div class="location-card">
          <h3 class="location-card-title">By City</h3>
          <div class="location-list" id="cityList">
            <p class="text-muted">Loading...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Charts -->
    <section class="admin-section">
      <h2 class="section-title">ğŸ“Š Platform Usage</h2>
      <div class="admin-charts-grid">
        <div class="admin-chart-card">
          <h3 class="chart-title">Feature Usage</h3>
          <div class="chart-container">
            <canvas id="featureUsageChart"></canvas>
          </div>
        </div>
        <div class="admin-chart-card">
          <h3 class="chart-title">Collection Activity</h3>
          <div class="chart-container">
            <canvas id="collectionActivityChart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- User Registration Trends -->
    <section class="admin-section">
      <h2 class="section-title">ğŸ“ˆ User Registration Trends</h2>
      <div class="admin-chart-card full-width">
        <div class="chart-container chart-container-lg">
          <canvas id="registrationTrendChart"></canvas>
        </div>
      </div>
    </section>

    <!-- Users Table with Pagination -->
    <section class="admin-section">
      <div class="section-header">
        <h2 class="section-title">ğŸ‘¥ Recent Users</h2>
        <div class="pagination-info" id="paginationInfo">Showing 0 users</div>
      </div>
      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>User</th>
              <th>Location</th>
              <th>Joined</th>
              <th>Last Active</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="usersTableBody">
            <tr><td colspan="5" class="text-center">Loading...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="pagination" id="pagination">
        <button class="pagination-btn" id="prevPageBtn" disabled>â† Previous</button>
        <span class="pagination-current" id="currentPage">Page 1</span>
        <button class="pagination-btn" id="nextPageBtn">Next â†’</button>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script type="module" src="assets/js/components/sidebar.js"></script>
  <script type="module" src="assets/js/pages/admin.js"></script>
</body>
</html>
