<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Rupiya Flat Group Details">
  <meta name="theme-color" content="#4A90E2">
  <title>Flat Group - Rupiya</title>

  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="assets/images/logo.png" type="image/png">
  
  <link rel="stylesheet" href="assets/css/bundles/core.bundle.css">
  <link rel="stylesheet" href="assets/css/bundles/dashboard.bundle.css">
  <link rel="stylesheet" href="assets/css/trip-group-detail.css">
  <link rel="stylesheet" href="assets/css/trip-ux-enhancements.css">
  <link rel="stylesheet" href="assets/css/dashboard-common.css">
  <link rel="stylesheet" href="assets/css/sidebar.css">
  <link rel="stylesheet" href="assets/css/mobile-scroll-fix.css">
  
  <script src="assets/js/utils/auth-guard.js"></script>
</head>

<body>
  <div class="dashboard-layout">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="assets/images/logo.png" alt="Rupiya">
        </div>
        <button class="sidebar-toggle" id="sidebarClose">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <nav class="sidebar-nav"></nav>
      <div class="sidebar-footer">
        <div class="user-profile" id="userProfile">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-info">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-email" id="userEmail">Loading...</div>
          </div>
        </div>
        <button class="btn btn-sm btn-outline w-100 mt-3" id="logoutBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
          </svg>
          Logout
        </button>
      </div>
    </aside>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <main class="main-content">
      <div class="mobile-header">
        <div class="mobile-brand">
          <img src="assets/images/logo.png" alt="Rupiya" style="height: 32px;">
        </div>
        <div class="mobile-header-actions">
          <button class="sidebar-toggle" id="sidebarOpen">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>

      <div class="page-header">
        <div class="page-header-back">
          <a href="flat-groups.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </a>
          <div>
            <h1 class="page-title" id="groupName">Loading...</h1>
            <p class="page-subtitle" id="groupAddress">-</p>
          </div>
        </div>
        <div class="page-actions">
          <button class="btn btn-outline" id="settingsBtn" style="display: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
      </div>

      <div class="quick-actions" id="quickActions">
        <button class="quick-action-btn" id="quickAddExpenseBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>Add Expense</span>
        </button>
        <button class="quick-action-btn secondary" id="quickSettleUpBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          <span>Settle Up</span>
        </button>
        <button class="quick-action-btn secondary" id="quickAddMemberBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
          </svg>
          <span>Add Flatmate</span>
        </button>
      </div>

      <div class="create-group-section" id="addExpenseSection">
        <div class="create-group-header">
          <h2>Add Expense</h2>
          <button type="button" class="close-create-btn" id="closeExpenseFormBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <form id="expenseForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="expenseAmount">Amount *</label>
              <input type="number" id="expenseAmount" step="0.01" min="0.01" required placeholder="0.00">
            </div>

            <div class="form-group">
              <label for="expenseCategory">Category *</label>
              <select id="expenseCategory" required>
                <option value="">Select category</option>
              </select>
            </div>

            <div class="form-group form-group-full">
              <label for="expenseDescription">Description *</label>
              <input type="text" id="expenseDescription" required maxlength="200"
                placeholder="What was this expense for?">
            </div>

            <div class="form-group">
              <label for="expenseDate">Date *</label>
              <input type="date" id="expenseDate" required>
            </div>

            <div class="form-group">
              <label for="expensePaidBy">Paid By *</label>
              <select id="expensePaidBy" required>
                <option value="">Select member</option>
              </select>
            </div>
          </div>

          <div class="split-section">
            <h3 class="section-title">Split Between</h3>

            <div class="split-type-selector">
              <label class="split-type-option">
                <input type="radio" name="splitType" value="equal" checked>
                <span>Equal Split</span>
              </label>
              <label class="split-type-option">
                <input type="radio" name="splitType" value="custom">
                <span>Custom Amounts</span>
              </label>
              <label class="split-type-option">
                <input type="radio" name="splitType" value="percentage">
                <span>Percentage</span>
              </label>
            </div>

            <div class="split-members" id="splitMembers"></div>

            <div class="split-summary" id="splitSummary">
              <span>Total: ‚Çπ<span id="splitTotal">0.00</span></span>
            </div>
          </div>

          <div class="create-group-footer">
            <button type="button" class="btn btn-outline" id="cancelExpenseBtn">Cancel</button>
            <button type="submit" class="btn btn-primary" id="saveExpenseBtn">Add Expense</button>
          </div>
        </form>
      </div>

      <div class="create-group-section" id="addSettlementSection" style="display: none;">
        <div class="create-group-header">
          <h2>Record Settlement</h2>
          <button type="button" class="close-create-btn" id="closeSettlementFormBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <form id="settlementForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="settlementFrom">Who Paid *</label>
              <select id="settlementFrom" required>
                <option value="">Select member</option>
              </select>
            </div>

            <div class="form-group">
              <label for="settlementTo">Paid To *</label>
              <select id="settlementTo" required>
                <option value="">Select member</option>
              </select>
            </div>

            <div class="form-group">
              <label for="settlementAmount">Amount *</label>
              <input type="number" id="settlementAmount" step="0.01" min="0.01" required placeholder="0.00">
            </div>

            <div class="form-group">
              <label for="settlementNotes">Notes</label>
              <input type="text" id="settlementNotes" maxlength="200" placeholder="Optional notes">
            </div>
          </div>

          <div class="create-group-footer">
            <button type="button" class="btn btn-outline" id="cancelSettlementBtn">Cancel</button>
            <button type="submit" class="btn btn-primary" id="saveSettlementBtn">Record Settlement</button>
          </div>
        </form>
      </div>

      <div class="create-group-section" id="addMemberSection" style="display: none;">
        <div class="create-group-header">
          <h2>Add Flatmate</h2>
          <button type="button" class="close-create-btn" id="closeMemberFormBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        <form id="memberForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="newMemberName">Name *</label>
              <input type="text" id="newMemberName" required maxlength="100" placeholder="Flatmate name">
            </div>

            <div class="form-group">
              <label for="newMemberEmail">Email</label>
              <input type="email" id="newMemberEmail" placeholder="email@example.com">
            </div>

            <div class="form-group">
              <label for="newMemberPhone">Phone</label>
              <input type="tel" id="newMemberPhone" placeholder="+91 9876543210">
            </div>
          </div>

          <div class="create-group-footer">
            <button type="button" class="btn btn-outline" id="cancelMemberBtn">Cancel</button>
            <button type="submit" class="btn btn-primary" id="saveMemberBtn">Add Flatmate</button>
          </div>
        </form>
      </div>

      <div class="balances-section">
        <div class="section-header">
          <h2 class="section-title">Balances</h2>
          <button class="btn btn-sm btn-outline" id="settleUpBtn">Settle Up</button>
        </div>

        <div class="balances-grid" id="balancesGrid"></div>

        <div class="simplified-debts" id="simplifiedDebts">
          <h3 class="debts-title">Who Owes Whom</h3>
          <div class="debts-list" id="debtsList"></div>
        </div>
      </div>

      <div class="detail-tabs">
        <button class="tab-btn active" data-tab="expenses">Expenses</button>
        <button class="tab-btn" data-tab="settlements">Settlements</button>
        <button class="tab-btn" data-tab="members">Flatmates</button>
        <button class="tab-btn" data-tab="analytics">Analytics</button>
      </div>

      <div class="tab-content active" id="expensesTab">
        <div class="expenses-filters">
          <select id="categoryFilter" class="filter-select">
            <option value="">All Categories</option>
          </select>
          <select id="memberFilter" class="filter-select">
            <option value="">All Members</option>
          </select>
        </div>

        <div class="expenses-list" id="expensesList"></div>

        <div class="empty-state" id="expensesEmpty" style="display: none;">
          <div class="empty-state-icon">üí∏</div>
          <h3 class="empty-state-title">No expenses yet</h3>
          <p class="empty-state-text">Add your first expense to start tracking.</p>
        </div>
      </div>

      <div class="tab-content" id="settlementsTab">
        <div class="settlements-list" id="settlementsList"></div>

        <div class="empty-state" id="settlementsEmpty" style="display: none;">
          <div class="empty-state-icon">ü§ù</div>
          <h3 class="empty-state-title">No settlements yet</h3>
          <p class="empty-state-text">Record a settlement when someone pays back.</p>
        </div>
      </div>

      <div class="tab-content" id="membersTab">
        <div class="members-grid" id="membersGrid"></div>

        <button class="btn btn-outline btn-block" id="addMemberBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Add Flatmate
        </button>
      </div>

      <div class="tab-content" id="analyticsTab">
        <div class="analytics-grid">
          <div class="analytics-card">
            <h3 class="analytics-title">Spending by Category</h3>
            <div class="category-breakdown" id="categoryBreakdown"></div>
          </div>

          <div class="analytics-card">
            <h3 class="analytics-title">Flat Statistics</h3>
            <div class="trip-stats" id="tripStats">
              <div class="stat-item">
                <span class="stat-label">Total Expenses</span>
                <span class="stat-value" id="statTotalExpenses">‚Çπ0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Number of Expenses</span>
                <span class="stat-value" id="statExpenseCount">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Average per Expense</span>
                <span class="stat-value" id="statAvgExpense">‚Çπ0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Monthly Average</span>
                <span class="stat-value" id="statDailyAvg">‚Çπ0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Per Person Average</span>
                <span class="stat-value" id="statPerPerson">‚Çπ0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Most Expensive Category</span>
                <span class="stat-value" id="statTopCategory">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="loadingState" class="loading-state">
        <div class="spinner-lg"></div>
        <p>Loading flat details...</p>
      </div>
    </main>
  </div>

  <button class="trip-fab" id="flatFab" title="Add Expense">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
    </svg>
  </button>

  <script type="module" src="assets/js/components/sidebar.js"></script>
  <script type="module" src="assets/js/pages/flat-group-detail.js?v=6"></script>
  <script type="module" src="assets/js/pwa-setup.js"></script>
  <script type="module" src="assets/js/utils/dashboard-common.js"></script>
</body>
</html>
