<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Button Fix Test Page</title>
  
  <link rel="stylesheet" href="assets/css/common.css">
  <link rel="stylesheet" href="assets/css/components.css">
  <link rel="stylesheet" href="assets/css/button-fix.css">
  
  <script src="assets/js/utils/button-reset-fix.js"></script>
  
  <style>
    body {
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin: 2rem 0;
      padding: 1.5rem;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .test-section h2 {
      margin-top: 0;
    }
    .btn {
      margin: 0.5rem;
    }
    .status {
      margin-top: 1rem;
      padding: 1rem;
      background: #f5f5f5;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    .success { color: #28a745; }
    .error { color: #dc3545; }
    .info { color: #17a2b8; }
  </style>
</head>
<body>
  <h1>Button Fix Test Page</h1>
  <p>This page helps you test the button reset failsafe system.</p>

  <div class="test-section">
    <h2>Test 1: Normal Button Behavior</h2>
    <p>Click this button. It should show loading for 2 seconds, then reset automatically.</p>
    <button class="btn btn-primary" id="normalBtn">Test Normal Button</button>
    <div class="status" id="normalStatus">Status: Ready</div>
  </div>

  <div class="test-section">
    <h2>Test 2: Stuck Button (Simulated Error)</h2>
    <p>Click this button. It will get "stuck" in loading state. The failsafe should reset it after 10 seconds.</p>
    <button class="btn btn-primary" id="stuckBtn">Test Stuck Button</button>
    <div class="status" id="stuckStatus">Status: Ready</div>
  </div>

  <div class="test-section">
    <h2>Test 3: Payment Method Button</h2>
    <p>This simulates the actual "Add Payment Method" button.</p>
    <button class="btn btn-primary" id="addPaymentMethodBtn">Add Payment Method</button>
    <div class="status" id="paymentStatus">Status: Ready</div>
  </div>

  <div class="test-section">
    <h2>Test 4: Manual Stuck Button</h2>
    <p>Click this button to manually create a stuck button. Then refresh the page to test page load reset.</p>
    <button class="btn btn-primary" id="manualStuckBtn">Make Button Stuck</button>
    <div class="status" id="manualStatus">Status: Ready</div>
  </div>

  <div class="test-section">
    <h2>Console Messages</h2>
    <p>Open browser DevTools (F12) and check the Console tab for these messages:</p>
    <ul>
      <li><code>[Button Fix] Button reset failsafe initialized</code> - Script loaded</li>
      <li><code>[Button Fix] Resetting stuck button: ...</code> - Button reset on page load</li>
      <li><code>[Button Fix] Auto-resetting button after 10s: ...</code> - Timeout reset</li>
      <li><code>[Button Fix] Timeout reset for: ...</code> - Mutation observer reset</li>
    </ul>
  </div>

  <script>
    // Test 1: Normal button
    document.getElementById('normalBtn').addEventListener('click', function() {
      const btn = this;
      const status = document.getElementById('normalStatus');
      
      status.innerHTML = '<span class="info">Status: Loading...</span>';
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span style="margin-left: 8px;">Loading...</span>';
      
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'Test Normal Button';
        status.innerHTML = '<span class="success">Status: ✓ Reset successfully (normal flow)</span>';
      }, 2000);
    });

    // Test 2: Stuck button (simulates error)
    document.getElementById('stuckBtn').addEventListener('click', function() {
      const btn = this;
      const status = document.getElementById('stuckStatus');
      
      status.innerHTML = '<span class="error">Status: Button stuck! Waiting for failsafe (10s)...</span>';
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span style="margin-left: 8px;">Loading...</span>';
      
      // Intentionally don't reset the button - let the failsafe handle it
      let countdown = 10;
      const interval = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          status.innerHTML = `<span class="error">Status: Button stuck! Failsafe in ${countdown}s...</span>`;
        } else {
          clearInterval(interval);
          if (!btn.disabled) {
            status.innerHTML = '<span class="success">Status: ✓ Failsafe reset successful!</span>';
          } else {
            status.innerHTML = '<span class="error">Status: ✗ Failsafe failed - button still stuck</span>';
          }
        }
      }, 1000);
    });

    // Test 3: Payment method button
    document.getElementById('addPaymentMethodBtn').addEventListener('click', function() {
      const btn = this;
      const status = document.getElementById('paymentStatus');
      
      status.innerHTML = '<span class="info">Status: Adding payment method...</span>';
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span style="margin-left: 8px;">Adding...</span>';
      
      // Simulate successful operation
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'Add Payment Method';
        status.innerHTML = '<span class="success">Status: ✓ Payment method added</span>';
      }, 2000);
    });

    // Test 4: Manual stuck button
    document.getElementById('manualStuckBtn').addEventListener('click', function() {
      const btn = this;
      const status = document.getElementById('manualStatus');
      
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span><span style="margin-left: 8px;">Stuck...</span>';
      status.innerHTML = '<span class="error">Status: Button is now stuck! Refresh the page (F5) to test page load reset.</span>';
      
      // Don't reset - leave it stuck for page reload test
    });

    // Log when page loads
    console.log('%c[Test Page] Button test page loaded', 'color: blue; font-weight: bold');
    console.log('%c[Test Page] Check for "[Button Fix]" messages in console', 'color: blue');
  </script>
</body>
</html>
